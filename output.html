<!DOCTYPE html>
<html lang="en"><head>
<script src="output_files/libs/clipboard/clipboard.min.js"></script>
<script src="output_files/libs/quarto-html/tabby.min.js"></script>
<script src="output_files/libs/quarto-html/popper.min.js"></script>
<script src="output_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="output_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="output_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="output_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="output_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.450">

  <meta name="author" content="Nick Christofides">
  <title>timeplyr - Fast Tidy Functions for Date and Time Manipulation</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="output_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="output_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="output_files/libs/revealjs/dist/theme/quarto.css">
  <link href="output_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="output_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="output_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="output_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="clock2.jpg" class="quarto-title-block center">
  <h1 class="title">timeplyr - Fast Tidy Functions for Date and Time Manipulation</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Nick Christofides 
</div>
</div>
</div>

</section>
<section id="i-am.." class="slide level2" data-background-color="white" data-background-image="clock2.jpg">
<h2>I am..</h2>
<aside class="notes">
<p>Healthcare analyst at Public Health Scotland</p>
<p>work primarily in health and social care data</p>
<p>I’m an R programmer and love data and coding (as I’m sure most of you do as well)</p>
<p>I’m someone that loves open source and learning new things</p>
<p>In my spare time, usually after a long day of R bugs and data quality issues, I like to take out my frustration on the drums, usually in the form of metal music</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div>
<ul>
<li class="fragment"><p>Healthcare Analyst primarily focused on working with health and social care data</p></li>
<li class="fragment"><p>R programmer (duh)</p></li>
<li class="fragment"><p>Someone that loves open source, learning new things and solving problems</p></li>
<li class="fragment"><p>Rock and heavy metal drummer</p>
<p><img data-src="lars_is_the_best_maybe.jpg" width="251"></p></li>
</ul>
</div>
</section>
<section id="what-is-timeplyr" class="slide level2" data-background-color="white" data-background-image="clock2.jpg">
<h2>What is timeplyr?</h2>
<aside class="notes">
<p>I want to say that first and foremost, it really is just a personal project of mine,</p>
<p>a place where I could put my ideas into practice and hone my R skills.</p>
<p>The most important thing is that it’s a package that I personally find useful and hope others will too.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div>
<p>A package designed to make it easier to manipulate messy, large longitudinal and time-based datasets with potentially many groups.</p>
<p>It was inspired by my work analysing COVID-19 data consisting of millions of individuals.</p>
<p>It’s a package of functions I find useful!</p>
</div>
</section>
<section id="it-can-for-example" class="slide level2" data-background-color="white" data-background-image="clock2.jpg">
<h2>It can for example:</h2>
<div>
<p>✅ Aggregate dates and date-times into any time interval, such as days, weeks, months and years</p>
<p>✅ Identify and complete missing gaps in time</p>
<p>✅ Apply rolling calculations for large numbers of groups, with respect to a time index</p>
<p>✅ Calculate key episodic information based on events separated by a specified threshold of time</p>
<aside class="notes">
<p>For example, classifying events of COVID-19 reinfection defined as having a positive test 90 days after your last positive test.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section id="it-cannot" class="slide level2" data-background-color="white" data-background-image="clock2.jpg">
<h2>It cannot:</h2>
<div>
<p>❌Perform advanced time-series analysis</p>
<p>❌Advanced data visualisation</p>
<p>❌Modelling or machine-learning</p>
<aside class="notes">
<p>Cannot do things like: correlation, seasonality, anomaly detection, smoothing, ACF/PACF plots, etc.<br>
The exception is a simple ggplot wrapper function to nicely plot simple time-series line graphs.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section id="why-timeplyr" class="slide level2 incremental" data-background-color="white" data-background-image="clock2.jpg">
<h2>Why timeplyr?</h2>
<aside class="notes">
<p>So why timeplyr? Well firstly because I think it combines speed with a user friendly interface.<br>
Many of the functions were written with ease-of-use in mind and sensible defaults. It’s generally quite fast as it heavily relies on packages like collapse, data.table and dplyr, as well as custom C++ code.</p>
<p>I have also tried to maintain a certain level of consistency and safety so that things like zero-length vectors, and other strange inputs don’t cause unexpected errors.</p>
<p>It’s still in development and constantly being built upon and improved. Even though there is currently only one maintainer (myself), I’m quite quick to respond to issues.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<ul>
<li><p><strong>Fast</strong> - Uses a mix of collapse, data.table, dplyr and custom C++ to be as fast and efficient as possible</p></li>
<li><p><strong>Consistent</strong> - Uses tidy principles where possible with emphasis on code safety</p></li>
<li><p><strong>Developing</strong> - It is continuously being built and improved upon</p></li>
</ul>
</section>
<section id="some-simple-examples" class="slide level2" data-background-color="white" data-background-image="clock2.jpg">
<h2>Some simple examples</h2>
<aside class="notes">
<p>Throughout the rest of the slides, we will be using the well-known flights dataset used in the R for data science book by Hadley Wickham to showcase some of the package functionality.</p>
<p>The data consists of flights departing from New York across the year 2013.</p>
<p>I will preface this by saying that the rest of the presentation will be quite practical and code-heavy, so I hope that is okay with you!</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>Using a well-known tidyverse dataset of flights departing from 3 NYC airports in 2013.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(timeplyr)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(bench)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="gaps-in-time" class="slide level2 smaller" data-background-color="white" data-background-image="clock2.jpg">
<h2>Gaps in time</h2>
<aside class="notes">
<p>In the first example, we are using the time_hour variable to check for missing gaps in time, i.e how many hours were there no flights?</p>
<p>This time_hour variable records the hour in which a flight departed.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>We can easily check for missing gaps in time with <code>time_num_gaps()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Adding a date variable (day of flight)</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>flights <span class="ot">&lt;-</span> flights <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as_date</span>(time_hour))</span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co"># Check for hours with no flights</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>(n_gaps <span class="ot">&lt;-</span> <span class="fu">time_num_gaps</span>(flights<span class="sc">$</span>time_hour))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1819</code></pre>
</div>
</div>
<p>We can also use <code>time_num_gaps()</code> with an additional argument <code>g</code> to find the number of gaps for each group, in this case, each airport.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">time_num_gaps</span>(flights<span class="sc">$</span>time_hour, <span class="at">g =</span> flights<span class="sc">$</span>origin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> EWR  JFK  LGA 
2489 1820 2468 </code></pre>
</div>
</div>
</section>
<section id="completing-gaps" class="slide level2 smaller" data-background-color="white" data-background-image="clock2.jpg">
<h2>Completing gaps</h2>
<aside class="notes">
<p>In this example we can see how to complete these gaps using the time_complete function.</p>
<p>We start by counting the number of flights per hour and then using time_complete to fill in any gaps. It’s worth noting that by default time_complete finds the minimum and maximum time, as well as figuring out that it is an hourly sequence.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>hourly_flights <span class="ot">&lt;-</span> flights <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="fu">count</span>(time_hour)</span>
<span id="cb6-3"><a href="#cb6-3"></a>hourly_flights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,936 × 2
   time_hour               n
   &lt;dttm&gt;              &lt;int&gt;
 1 2013-01-01 05:00:00     6
 2 2013-01-01 06:00:00    52
 3 2013-01-01 07:00:00    49
 4 2013-01-01 08:00:00    58
 5 2013-01-01 09:00:00    56
 6 2013-01-01 10:00:00    39
 7 2013-01-01 11:00:00    37
 8 2013-01-01 12:00:00    56
 9 2013-01-01 13:00:00    54
10 2013-01-01 14:00:00    48
# ℹ 6,926 more rows</code></pre>
</div>
</div>
<p>Here we complete the hourly gaps using <code>time_complete()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>completed <span class="ot">&lt;-</span> hourly_flights <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">time_complete</span>(time_hour)</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co"># Sanity check</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>(<span class="fu">nrow</span>(completed) <span class="sc">-</span> <span class="fu">nrow</span>(hourly_flights) ) <span class="sc">==</span> n_gaps</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="monthly-summaries" class="slide level2 smaller" data-background-color="white" data-background-image="clock2.jpg">
<h2>Monthly summaries</h2>
<p>Using <code>time_count()</code> we can very quickly count the number of flights each month.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">time_count</span>(date, <span class="at">time_by =</span> <span class="st">"month"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
   date           n
   &lt;date&gt;     &lt;int&gt;
 1 2013-01-01 27004
 2 2013-02-01 24951
 3 2013-03-01 28834
 4 2013-04-01 28330
 5 2013-05-01 28796
 6 2013-06-01 28243
 7 2013-07-01 29425
 8 2013-08-01 29327
 9 2013-09-01 27574
10 2013-10-01 28889
11 2013-11-01 27268
12 2013-12-01 28135</code></pre>
</div>
</div>
<p>We can make our implicit month interval into a more explicit one with the <code>as_interval</code> argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="fu">time_count</span>(date, <span class="at">time_by =</span> <span class="st">"month"</span>, <span class="at">as_interval =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
                       date     n
                  &lt;tm_intv&gt; &lt;int&gt;
 1 [2013-01-01, 2013-02-01) 27004
 2 [2013-02-01, 2013-03-01) 24951
 3 [2013-03-01, 2013-04-01) 28834
 4 [2013-04-01, 2013-05-01) 28330
 5 [2013-05-01, 2013-06-01) 28796
 6 [2013-06-01, 2013-07-01) 28243
 7 [2013-07-01, 2013-08-01) 29425
 8 [2013-08-01, 2013-09-01) 29327
 9 [2013-09-01, 2013-10-01) 27574
10 [2013-10-01, 2013-11-01) 28889
11 [2013-11-01, 2013-12-01) 27268
12 [2013-12-01, 2014-01-01) 28135</code></pre>
</div>
</div>
</section>
<section id="year_months" class="slide level2 smaller" data-background-color="white" data-background-image="clock2.jpg">
<h2>year_months</h2>
<p>timeplyr has it’s own year-month class, inspired by the excellent zoo and tsibble packages</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">year_month</span>(<span class="fu">today</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024 Jan"</code></pre>
</div>
</div>
<p>It is very easy to create a sequence of year_months</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">year_month</span>(<span class="fu">today</span>()) <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">11</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "2024 Jan" "2024 Feb" "2024 Mar" "2024 Apr" "2024 May" "2024 Jun"
 [7] "2024 Jul" "2024 Aug" "2024 Sep" "2024 Oct" "2024 Nov" "2024 Dec"</code></pre>
</div>
</div>
</section>
<section id="time_by" class="slide level2 smaller" data-background-color="white" data-background-image="clock2.jpg">
<h2>time_by</h2>
<p>The <code>time_by()</code> function is similar to dplyr’s <code>group_by()</code> but with an emphasis on dates and date-times.</p>
<div>
<aside class="notes">
<p>Here we make use of <code>time_by()</code> to count the number of flights per quarter as well as the average departure delay.</p>
<p>As a little addition we can utilise time intervals from the development version of timeplyr, as well as specifying a formatting function for the start and ends of the intervals.</p>
<p>We can see that in a very short amount of code, we have created a quarterly summary of the number of flights, as well as the mean departure delay.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
<p>Let’s work with time_intervals throughout by setting the <code>timeplyr.use_intervals</code> option to true.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">options</span>(<span class="at">timeplyr.use_intervals =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="fu">options</span>(<span class="at">timeplyr.interval_sub_formatter =</span> \(x) <span class="fu">format</span>(x, <span class="st">"%b-%d"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Number of flights and mean departure delay per quarter</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>flights <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="fu">time_by</span>(date, <span class="st">"3 months"</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">mean_dep_delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
              date     n mean_dep_delay
         &lt;tm_intv&gt; &lt;int&gt;          &lt;dbl&gt;
1 [Jan-01, Apr-01) 80789          11.4 
2 [Apr-01, Jul-01) 85369          15.9 
3 [Jul-01, Oct-01) 86326          13.8 
4 [Oct-01, Jan-01) 84292           9.36</code></pre>
</div>
</div>
</section>
<section id="diving-into-the-arguments-of-time_count" class="slide level2 smaller" data-background-color="white" data-background-image="clock2.jpg">
<h2>Diving into the arguments of <code>time_count</code></h2>
<aside class="notes">
<p>Now if we were to look at the arguments to time_count we will see quite a lot of arguments which may be intimidating at first, but I assure you they’re not as frightening as you might think.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">args</a></li><li><a href="#tabset-1-2">time</a></li><li><a href="#tabset-1-3">…</a></li><li><a href="#tabset-1-4">time_by</a></li><li><a href="#tabset-1-5">from &amp; to</a></li><li><a href="#tabset-1-6">time_type &amp; time_floor</a></li><li><a href="#tabset-1-7">as_interval</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<p><img data-src="Screenshot%202024-01-25%20093037.png"></p>
</div>
<div id="tabset-1-2">
<p>This is just the time variable we want to specify.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="fu">time_count</span>(<span class="at">time =</span> date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 2
               date     n
          &lt;tm_intv&gt; &lt;int&gt;
 1 [Jan-01, Jan-02)   842
 2 [Jan-02, Jan-03)   943
 3 [Jan-03, Jan-04)   914
 4 [Jan-04, Jan-05)   915
 5 [Jan-05, Jan-06)   720
 6 [Jan-06, Jan-07)   832
 7 [Jan-07, Jan-08)   933
 8 [Jan-08, Jan-09)   899
 9 [Jan-09, Jan-10)   902
10 [Jan-10, Jan-11)   932
# ℹ 355 more rows</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3">
<p>These are additional variables to count which use dplyr style data-masking</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>flights <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="fu">time_count</span>(date, <span class="fu">across</span>(<span class="fu">where</span>(is.character)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 316,497 × 6
               date carrier tailnum origin dest      n
          &lt;tm_intv&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;int&gt;
 1 [Jan-01, Jan-02) 9E      N602LR  JFK    CVG       1
 2 [Jan-01, Jan-02) 9E      N604LR  JFK    MSP       1
 3 [Jan-01, Jan-02) 9E      N836AY  JFK    PHL       1
 4 [Jan-01, Jan-02) 9E      N8409N  JFK    SYR       1
 5 [Jan-01, Jan-02) 9E      N8444F  JFK    CLE       1
 6 [Jan-01, Jan-02) 9E      N8444F  JFK    IAD       1
 7 [Jan-01, Jan-02) 9E      N8515F  JFK    RDU       1
 8 [Jan-01, Jan-02) 9E      N8598B  JFK    BWI       1
 9 [Jan-01, Jan-02) 9E      N8611A  JFK    RDU       1
10 [Jan-01, Jan-02) 9E      N8631E  JFK    ROC       1
# ℹ 316,487 more rows</code></pre>
</div>
</div>
</div>
<div id="tabset-1-4">
<p>This argument allows us to control which time unit we will aggregate our time variable to.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href="#cb25-2"></a>  <span class="fu">time_count</span>(date, <span class="at">time_by =</span> <span class="st">"2 weeks"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27 × 2
               date     n
          &lt;tm_intv&gt; &lt;int&gt;
 1 [Jan-01, Jan-15) 12208
 2 [Jan-15, Jan-29) 12078
 3 [Jan-29, Feb-12) 12173
 4 [Feb-12, Feb-26) 12649
 5 [Feb-26, Mar-12) 13009
 6 [Mar-12, Mar-26) 13100
 7 [Mar-26, Apr-09) 13145
 8 [Apr-09, Apr-23) 13239
 9 [Apr-23, May-07) 13080
10 [May-07, May-21) 13019
# ℹ 17 more rows</code></pre>
</div>
</div>
<p>If left unspecified, most of the time the <code>time_</code> functions will try to guess the time granularity through the greatest common divisor of time differences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">abs</span>(<span class="fu">gcd_diff</span>(flights<span class="sc">$</span>time_hour))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3600</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">time_diff_gcd</span>(flights<span class="sc">$</span>time_hour)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$numeric
[1] 3600</code></pre>
</div>
</div>
<p>We see <code>gcd_diff()</code> returns 3600, which is the number of seconds in an hour.</p>
</div>
<div id="tabset-1-5">
<p>This allows us to specify start and end times</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb31-2"><a href="#cb31-2"></a>  <span class="fu">time_count</span>(date, <span class="at">time_by =</span> <span class="st">"2 weeks"</span>,</span>
<span id="cb31-3"><a href="#cb31-3"></a>             <span class="at">from =</span> <span class="fu">dmy</span>(<span class="st">"01-December-2013"</span>),</span>
<span id="cb31-4"><a href="#cb31-4"></a>             <span class="at">.by =</span> origin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   origin             date      n
   &lt;chr&gt;         &lt;tm_intv&gt;  &lt;int&gt;
 1 EWR    [Dec-01, Dec-15)   4596
 2 EWR    [Dec-15, Dec-29)   4398
 3 EWR    [Dec-29, Jan-12)    928
 4 EWR    NA               110913
 5 JFK    [Dec-01, Dec-15)   4049
 6 JFK    [Dec-15, Dec-29)   4187
 7 JFK    [Dec-29, Jan-12)    910
 8 JFK    NA               102133
 9 LGA    [Dec-01, Dec-15)   4271
10 LGA    [Dec-15, Dec-29)   4002
11 LGA    [Dec-29, Jan-12)    794
12 LGA    NA                95595</code></pre>
</div>
</div>
</div>
<div id="tabset-1-6">
<p><code>time_type</code> controls whether we use lubridate style durations or periods.<br>
By default, durations are used for anything more granular than a day, and periods otherwise.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="fu">options</span>(<span class="at">timeplyr.interval_sub_formatter =</span> identity)</span>
<span id="cb33-2"><a href="#cb33-2"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="fu">time_count</span>(date, <span class="at">time_by =</span> <span class="st">"3 months"</span>,</span>
<span id="cb33-4"><a href="#cb33-4"></a>             <span class="at">time_type =</span> <span class="st">"period"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
                      date     n
                 &lt;tm_intv&gt; &lt;int&gt;
1 [2013-01-01, 2013-04-01) 80789
2 [2013-04-01, 2013-07-01) 85369
3 [2013-07-01, 2013-10-01) 86326
4 [2013-10-01, 2014-01-01) 84292</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="fu">time_count</span>(date, <span class="at">time_by =</span> <span class="st">"3 months"</span>,</span>
<span id="cb35-3"><a href="#cb35-3"></a>             <span class="at">time_type =</span> <span class="st">"duration"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
                                        date     n
                                   &lt;tm_intv&gt; &lt;int&gt;
1 [2013-01-01, 2013-04-02 07:30:00)          82742
2 [2013-04-02 07:30:00, 2013-07-02 15:00:00) 85327
3 [2013-07-02 15:00:00, 2013-10-01 22:30:00) 85380
4 [2013-10-01 22:30:00, 2014-01-01 06:00:00) 83327</code></pre>
</div>
</div>
<p><code>time_floor</code> Takes the minimum time and floors it to the nearest specified unit (excluding the multiple). If for example you specified <code>time_by = "3 months"</code>, <code>time_floor = TRUE</code> would round the earliest time to the nearest month.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a href="#cb37-2"></a>    <span class="fu">time_count</span>(date, <span class="at">time_by =</span> <span class="st">"3 months"</span>,</span>
<span id="cb37-3"><a href="#cb37-3"></a>               <span class="at">from =</span> <span class="fu">dmy</span>(<span class="st">"22-August-2013"</span>),</span>
<span id="cb37-4"><a href="#cb37-4"></a>               <span class="at">time_floor =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
                      date      n
                 &lt;tm_intv&gt;  &lt;int&gt;
1 [2013-08-22, 2013-11-22)  85195
2 [2013-11-22, 2014-02-22)  35871
3 NA                       215710</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2"></a>    <span class="fu">time_count</span>(date, <span class="at">time_by =</span> <span class="st">"3 months"</span>,</span>
<span id="cb39-3"><a href="#cb39-3"></a>               <span class="at">from =</span> <span class="fu">dmy</span>(<span class="st">"22-August-2013"</span>),</span>
<span id="cb39-4"><a href="#cb39-4"></a>               <span class="at">time_floor =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
                      date      n
                 &lt;tm_intv&gt;  &lt;int&gt;
1 [2013-08-01, 2013-11-01)  65663
2 [2013-11-01, 2014-02-01)  55403
3 NA                       215710</code></pre>
</div>
</div>
</div>
<div id="tabset-1-7">
<p>This argument controls whether the start of the implicit time interval is returned, or whether an explicit <code>time_interval</code> is returned.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="#cb41-2"></a>  <span class="fu">time_count</span>(date, <span class="at">time_by =</span> <span class="st">"months"</span>, <span class="at">as_interval =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
   date           n
   &lt;date&gt;     &lt;int&gt;
 1 2013-01-01 27004
 2 2013-02-01 24951
 3 2013-03-01 28834
 4 2013-04-01 28330
 5 2013-05-01 28796
 6 2013-06-01 28243
 7 2013-07-01 29425
 8 2013-08-01 29327
 9 2013-09-01 27574
10 2013-10-01 28889
11 2013-11-01 27268
12 2013-12-01 28135</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb43-2"><a href="#cb43-2"></a>  <span class="fu">time_count</span>(date, <span class="at">time_by =</span> <span class="st">"months"</span>, <span class="at">as_interval =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
                       date     n
                  &lt;tm_intv&gt; &lt;int&gt;
 1 [2013-01-01, 2013-02-01) 27004
 2 [2013-02-01, 2013-03-01) 24951
 3 [2013-03-01, 2013-04-01) 28834
 4 [2013-04-01, 2013-05-01) 28330
 5 [2013-05-01, 2013-06-01) 28796
 6 [2013-06-01, 2013-07-01) 28243
 7 [2013-07-01, 2013-08-01) 29425
 8 [2013-08-01, 2013-09-01) 29327
 9 [2013-09-01, 2013-10-01) 27574
10 [2013-10-01, 2013-11-01) 28889
11 [2013-11-01, 2013-12-01) 27268
12 [2013-12-01, 2014-01-01) 28135</code></pre>
</div>
</div>
<p>Sometimes the former is more useful, especially for plotting and formatting, for example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb45-2"><a href="#cb45-2"></a>  <span class="fu">time_count</span>(date, <span class="at">time_by =</span> <span class="st">"months"</span>, <span class="at">as_interval =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb45-3"><a href="#cb45-3"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">format</span>(date, <span class="st">"%B"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   date           n month    
   &lt;date&gt;     &lt;int&gt; &lt;chr&gt;    
 1 2013-01-01 27004 January  
 2 2013-02-01 24951 February 
 3 2013-03-01 28834 March    
 4 2013-04-01 28330 April    
 5 2013-05-01 28796 May      
 6 2013-06-01 28243 June     
 7 2013-07-01 29425 July     
 8 2013-08-01 29327 August   
 9 2013-09-01 27574 September
10 2013-10-01 28889 October  
11 2013-11-01 27268 November 
12 2013-12-01 28135 December </code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="time-series" class="slide level2 smaller" data-background-color="white" data-background-image="clock2.jpg">
<h2>Time series</h2>
<p>We can easily convert time series to a (long) tibble</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>eu_stock <span class="ot">&lt;-</span> EuStockMarkets <span class="sc">|&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2"></a>  <span class="fu">ts_as_tibble</span>()</span>
<span id="cb47-3"><a href="#cb47-3"></a>eu_stock</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7,440 × 3
   group  time value
   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 DAX   1991. 1629.
 2 DAX   1992. 1614.
 3 DAX   1992. 1607.
 4 DAX   1992. 1621.
 5 DAX   1992. 1618.
 6 DAX   1992. 1611.
 7 DAX   1992. 1631.
 8 DAX   1992. 1640.
 9 DAX   1992. 1635.
10 DAX   1992. 1646.
# ℹ 7,430 more rows</code></pre>
</div>
</div>
<p><code>ts_as_tibble()</code> currently supports <code>ts</code>, <code>xts</code>, <code>zoo</code> and <code>timeSeries</code> objects.</p>
</section>
<section id="quick-plotting" class="slide level2 smaller" data-background-color="white" data-background-image="clock2.jpg">
<h2>Quick plotting</h2>
<p>We can also plot univariate and multivariate time-series data using <code>time_ggplot()</code> which is just a ggplot wrapper that applies some sensible axes and formatting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># #| output-location: column</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>eu_stock <span class="sc">|&gt;</span> </span>
<span id="cb49-3"><a href="#cb49-3"></a>  <span class="fu">time_ggplot</span>(time, value, <span class="at">group =</span> group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="output_files/figure-revealjs/unnamed-chunk-22-1.png" width="960" class="r-stretch"></section>
<section id="rolling-functions" class="slide level2" data-background-color="white" data-background-image="clock2.jpg">
<h2>Rolling functions</h2>
<p>timeplyr has a set of optimised functions, utilising data.table’s excellent <code>frollmean()</code> and friends. It builds upon these by incorporating a fast method for grouped calculations, as well as incorporating time-based windows.</p>
</section>
<section id="combining-timeplyr-and-data.table" class="slide level2 smaller" data-background-color="white" data-background-image="clock2.jpg">
<h2>Combining timeplyr and data.table</h2>
<h3 id="benchmark-unsorted-data-10000-groups-1m-rows">Benchmark (unsorted data, 10,000 groups, 1m rows)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb50-2"><a href="#cb50-2"></a>df <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>),</span>
<span id="cb50-3"><a href="#cb50-3"></a>                 <span class="at">g =</span> <span class="fu">sample.int</span>(<span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, <span class="cn">TRUE</span>))</span>
<span id="cb50-4"><a href="#cb50-4"></a><span class="fu">mark</span>(df[, <span class="at">dt_mean :=</span> <span class="fu">frollmean</span>(x, <span class="at">n =</span> <span class="dv">7</span>, </span>
<span id="cb50-5"><a href="#cb50-5"></a>                               <span class="at">align =</span> <span class="st">"right"</span>, <span class="at">na.rm =</span> <span class="cn">FALSE</span>),</span>
<span id="cb50-6"><a href="#cb50-6"></a>        <span class="at">by =</span> g])</span>
<span id="cb50-7"><a href="#cb50-7"></a><span class="co">#&gt; Warning: Some expressions had a GC in every iteration; so filtering is</span></span>
<span id="cb50-8"><a href="#cb50-8"></a><span class="co">#&gt; disabled.</span></span>
<span id="cb50-9"><a href="#cb50-9"></a><span class="co">#&gt; # A tibble: 1 × 6</span></span>
<span id="cb50-10"><a href="#cb50-10"></a><span class="co">#&gt;   expression                             min median `itr/sec` mem_alloc `gc/sec`</span></span>
<span id="cb50-11"><a href="#cb50-11"></a><span class="co">#&gt;   &lt;bch:expr&gt;                           &lt;bch&gt; &lt;bch:&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span></span>
<span id="cb50-12"><a href="#cb50-12"></a><span class="co">#&gt; 1 "df[, `:=`(dt_mean, frollmean(x, n … 425ms  469ms      2.13     179MB     21.3</span></span>
<span id="cb50-13"><a href="#cb50-13"></a><span class="fu">mark</span>(df[, <span class="at">tp_mean :=</span> <span class="fu">roll_mean</span>(x, <span class="at">window =</span> <span class="dv">7</span>, </span>
<span id="cb50-14"><a href="#cb50-14"></a>                               <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">partial =</span> <span class="cn">FALSE</span>, </span>
<span id="cb50-15"><a href="#cb50-15"></a>                               <span class="at">g =</span> g)])</span>
<span id="cb50-16"><a href="#cb50-16"></a><span class="co">#&gt; # A tibble: 1 × 6</span></span>
<span id="cb50-17"><a href="#cb50-17"></a><span class="co">#&gt;   expression                             min median `itr/sec` mem_alloc `gc/sec`</span></span>
<span id="cb50-18"><a href="#cb50-18"></a><span class="co">#&gt;   &lt;bch:expr&gt;                           &lt;bch&gt; &lt;bch:&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span></span>
<span id="cb50-19"><a href="#cb50-19"></a><span class="co">#&gt; 1 df[, `:=`(tp_mean, roll_mean(x, win…  27ms 27.3ms      36.7      47MB     202.</span></span>
<span id="cb50-20"><a href="#cb50-20"></a><span class="fu">all.equal</span>(df<span class="sc">$</span>dt_mean, df<span class="sc">$</span>tp_mean)</span>
<span id="cb50-21"><a href="#cb50-21"></a><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="combining-timeplyr-and-data.table-1" class="slide level2" data-background-color="white" data-background-image="clock2.jpg">
<h2>Combining timeplyr and data.table</h2>
<p>We can use <code>window_sequence()</code> with data.table’s <code>adaptive</code> argument to easily calculate rolling stats with partial windows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>w <span class="ot">&lt;-</span> <span class="fu">window_sequence</span>(<span class="fu">length</span>(x), <span class="at">k =</span> <span class="fu">length</span>(x))</span>
<span id="cb51-3"><a href="#cb51-3"></a>data.table<span class="sc">::</span><span class="fu">frollsum</span>(x, <span class="at">n =</span> w, <span class="at">adaptive =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  3  6 10 15 21 28 36 45 55</code></pre>
</div>
</div>
</section>
<section id="more-rolling-madness" class="slide level2 smaller" data-background-color="white" data-background-image="clock2.jpg">
<h2>More rolling madness</h2>
<p>An example of a rolling sum, by group, with respect to a time index</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>g <span class="ot">&lt;-</span> <span class="fu">seq_id</span>(<span class="fu">rep</span>(<span class="dv">5</span>, <span class="dv">4</span>))</span>
<span id="cb53-3"><a href="#cb53-3"></a>t <span class="ot">&lt;-</span> <span class="fu">today</span>() <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">19</span>)</span>
<span id="cb53-4"><a href="#cb53-4"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(x, g, t)</span>
<span id="cb53-5"><a href="#cb53-5"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb53-6"><a href="#cb53-6"></a>  <span class="fu">mutate</span>(<span class="at">sum =</span> </span>
<span id="cb53-7"><a href="#cb53-7"></a>           <span class="fu">time_roll_sum</span>(x, <span class="at">time =</span> t, <span class="at">g =</span> g, </span>
<span id="cb53-8"><a href="#cb53-8"></a>                         <span class="at">window =</span> <span class="st">"3 days"</span>, <span class="at">partial =</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 4
       x     g t            sum
   &lt;int&gt; &lt;int&gt; &lt;date&gt;     &lt;dbl&gt;
 1     1     1 2024-01-26    NA
 2     2     1 2024-01-27    NA
 3     3     1 2024-01-28     6
 4     4     1 2024-01-29     9
 5     5     1 2024-01-30    12
 6     6     2 2024-01-31    NA
 7     7     2 2024-02-01    NA
 8     8     2 2024-02-02    21
 9     9     2 2024-02-03    24
10    10     2 2024-02-04    27
11    11     3 2024-02-05    NA
12    12     3 2024-02-06    NA
13    13     3 2024-02-07    36
14    14     3 2024-02-08    39
15    15     3 2024-02-09    42
16    16     4 2024-02-10    NA
17    17     4 2024-02-11    NA
18    18     4 2024-02-12    51
19    19     4 2024-02-13    54
20    20     4 2024-02-14    57</code></pre>
</div>
</div>
</section>
<section id="events-and-episodes" class="slide level2 smaller" data-background-color="white" data-background-image="clock2.jpg">
<h2>Events and Episodes</h2>
<p>It is surprisingly common to analyse time-based episodes in health datasets.<br>
Examples include identifying disease reinfection, or hospital readmission. The data may contain many records in quick succession, and so certain rules are applied to identify which ones are distinct episodes. One such criteria is setting a time threshold between events.</p>
<p>In this example we will show how to find reinfections in fictitious data of 1000 individuals receiving a test for an unknown (to us) disease, on average every 2 weeks. A third of these will be positive results. The aim is to classify these positives as new episodes when 42 days pass between the previous positive result.</p>
</section>
<section id="events-and-episodes-1" class="slide level2 smaller" data-background-color="white" data-background-image="clock2.jpg">
<h2>Events and Episodes</h2>
<h4 id="data-setup">Data setup</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="fu">set.seed</span>(<span class="dv">912398123</span>)</span>
<span id="cb55-2"><a href="#cb55-2"></a>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span></span>
<span id="cb55-3"><a href="#cb55-3"></a>initial_date <span class="ot">&lt;-</span> <span class="fu">today</span>()</span>
<span id="cb55-4"><a href="#cb55-4"></a>time_bw_tests <span class="ot">&lt;-</span> <span class="fu">rexp</span>(<span class="dv">10</span><span class="sc">^</span><span class="dv">3</span> <span class="sc">*</span> <span class="dv">10</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">14</span>)</span>
<span id="cb55-5"><a href="#cb55-5"></a></span>
<span id="cb55-6"><a href="#cb55-6"></a>initial_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(id, <span class="at">test_date =</span> initial_date)</span>
<span id="cb55-7"><a href="#cb55-7"></a></span>
<span id="cb55-8"><a href="#cb55-8"></a>df <span class="ot">&lt;-</span> initial_df <span class="sc">|&gt;</span> </span>
<span id="cb55-9"><a href="#cb55-9"></a>    <span class="fu">bind_rows</span>(</span>
<span id="cb55-10"><a href="#cb55-10"></a>        <span class="fu">tibble</span>(<span class="at">id =</span> <span class="fu">rep</span>(id, <span class="dv">10</span>), time_bw_tests) </span>
<span id="cb55-11"><a href="#cb55-11"></a>    )</span>
<span id="cb55-12"><a href="#cb55-12"></a></span>
<span id="cb55-13"><a href="#cb55-13"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb55-14"><a href="#cb55-14"></a>    <span class="fu">mutate</span>(<span class="at">time_bw_tests =</span> <span class="fu">replace_na</span>(time_bw_tests, <span class="dv">0</span>))</span>
<span id="cb55-15"><a href="#cb55-15"></a></span>
<span id="cb55-16"><a href="#cb55-16"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb55-17"><a href="#cb55-17"></a>    <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb55-18"><a href="#cb55-18"></a>    <span class="fu">mutate</span>(<span class="at">test_date =</span> <span class="fu">today</span>() <span class="sc">+</span> <span class="fu">cumsum</span>(<span class="fu">as.integer</span>(time_bw_tests))) <span class="sc">%&gt;%</span></span>
<span id="cb55-19"><a href="#cb55-19"></a>    <span class="fu">mutate</span>(<span class="at">test_date =</span> <span class="fu">replace_na</span>(test_date, <span class="fu">today</span>()))</span>
<span id="cb55-20"><a href="#cb55-20"></a></span>
<span id="cb55-21"><a href="#cb55-21"></a>events <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb55-22"><a href="#cb55-22"></a>    <span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="events-and-episodes-2" class="slide level2 smaller" data-background-color="white" data-background-image="clock2.jpg">
<h2>Events and Episodes</h2>
<h4 id="calculation">Calculation</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="co"># 1000 individuals, 10 tests each</span></span>
<span id="cb56-2"><a href="#cb56-2"></a><span class="co"># On average they take 1 test every 2 weeks</span></span>
<span id="cb56-3"><a href="#cb56-3"></a></span>
<span id="cb56-4"><a href="#cb56-4"></a>events <span class="ot">&lt;-</span> events <span class="sc">%&gt;%</span></span>
<span id="cb56-5"><a href="#cb56-5"></a>    <span class="fu">time_episodes</span>(test_date, <span class="at">time_by =</span> <span class="st">"days"</span>, <span class="at">window =</span> <span class="dv">42</span>)</span>
<span id="cb56-6"><a href="#cb56-6"></a>events</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble:        3,000 x 6
# Groups:          id [1,000]
# Episodes:        N: 1,784, Median: 2, Mean: 1.78 ▅▁▁▇▁▁▂
# Time b/w events: Pooled mean: ~1.33 months
# Threshold:       ~1.38 months
      id test_date  t_elapsed ep_start   ep_id ep_id_new
 * &lt;int&gt; &lt;date&gt;         &lt;dbl&gt; &lt;date&gt;     &lt;int&gt;     &lt;int&gt;
 1     1 2024-02-11         0 2024-02-11     1         1
 2     1 2024-03-13        31 2024-02-11     1         0
 3     1 2024-05-04        52 2024-05-04     2         2
 4     2 2024-01-28         0 2024-01-28     1         1
 5     2 2024-03-26        58 2024-03-26     2         2
 6     2 2024-04-09        14 2024-03-26     2         0
 7     3 2024-03-01        18 2024-02-12     1         0
 8     3 2024-03-23        22 2024-02-12     1         0
 9     3 2024-02-12         0 2024-02-12     1         1
10     4 2024-07-24       180 2024-07-24     2         2
# ℹ 2,990 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>reinfections <span class="ot">&lt;-</span> events <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2"></a>    <span class="fu">filter</span>(ep_id_new <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb58-3"><a href="#cb58-3"></a>reinfections</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble:        784 x 6
# Groups:          id [666]
# Episodes:        N: 784, Median: 1, Mean: 1.18 ▇▁▁▁▁▁▂
# Time b/w events: Pooled mean: ~2.5 months
# Threshold:       ~1.38 months
      id test_date  t_elapsed ep_start   ep_id ep_id_new
   &lt;int&gt; &lt;date&gt;         &lt;dbl&gt; &lt;date&gt;     &lt;int&gt;     &lt;int&gt;
 1     1 2024-05-04        52 2024-05-04     2         2
 2     2 2024-03-26        58 2024-03-26     2         2
 3     4 2024-07-24       180 2024-07-24     2         2
 4     5 2024-04-15        52 2024-04-15     2         2
 5     6 2024-04-16        51 2024-04-16     2         2
 6     8 2024-05-02        97 2024-05-02     2         2
 7     9 2024-03-25        42 2024-03-25     2         2
 8    12 2024-05-08        46 2024-05-08     2         2
 9    13 2024-06-01        53 2024-06-01     2         2
10    17 2024-05-20        90 2024-05-20     2         2
# ℹ 774 more rows</code></pre>
</div>
</div>
</section>
<section id="more-helpers" class="slide level2 smaller" data-background-color="white" data-background-image="clock2.jpg">
<h2>More helpers</h2>
<div class="panel-tabset smaller" data-background-image="clock2.jpg">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">time_seq</a></li><li><a href="#tabset-2-2">time_diff</a></li><li><a href="#tabset-2-3">group_id</a></li><li><a href="#tabset-2-4">time_elapsed</a></li><li><a href="#tabset-2-5">time_breaks</a></li><li><a href="#tabset-2-6">time_seq_id</a></li></ul>
<div class="tab-content smaller" data-background-image="clock2.jpg">
<div id="tabset-2-1">
<p><code>time_seq()</code> is like <code>seq()</code> but can accept a mix of dates and date-times</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>today <span class="ot">&lt;-</span> <span class="fu">today</span>()</span>
<span id="cb60-2"><a href="#cb60-2"></a>next_week <span class="ot">&lt;-</span> <span class="fu">as_datetime</span>(today <span class="sc">+</span> <span class="fu">dweeks</span>(<span class="dv">1</span>))</span>
<span id="cb60-3"><a href="#cb60-3"></a><span class="fu">time_seq</span>(today, next_week, <span class="st">"days"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-01-26 UTC" "2024-01-27 UTC" "2024-01-28 UTC" "2024-01-29 UTC"
[5] "2024-01-30 UTC" "2024-01-31 UTC" "2024-02-01 UTC" "2024-02-02 UTC"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="fu">seq</span>(today, next_week, <span class="st">"days"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in seq.Date(today, next_week, "days"): 'to' must be a "Date" object</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="co"># Vectorised version</span></span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="fu">time_seq_v</span>(today, next_week, <span class="fu">list</span>(<span class="at">days =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)) <span class="co"># from/to/by </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "2024-01-26 UTC" "2024-01-27 UTC" "2024-01-28 UTC" "2024-01-29 UTC"
 [5] "2024-01-30 UTC" "2024-01-31 UTC" "2024-02-01 UTC" "2024-02-02 UTC"
 [9] "2024-01-26 UTC" "2024-01-28 UTC" "2024-01-30 UTC" "2024-02-01 UTC"
[13] "2024-01-26 UTC" "2024-01-29 UTC" "2024-02-01 UTC"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="fu">time_seq_v2</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">from =</span> today, <span class="at">time_by =</span> <span class="st">"days"</span>) <span class="sc">|&gt;</span> <span class="co"># length/from/by</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>  <span class="fu">setNames</span>(<span class="fu">seq_id</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           1            2            2            3            3            3 
"2024-01-26" "2024-01-26" "2024-01-27" "2024-01-26" "2024-01-27" "2024-01-28" </code></pre>
</div>
</div>
</div>
<div id="tabset-2-2">
<p>A convenience function to calculate time differences</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>today <span class="ot">&lt;-</span> <span class="fu">today</span>()</span>
<span id="cb68-2"><a href="#cb68-2"></a>next_year <span class="ot">&lt;-</span> today <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">1</span>)</span>
<span id="cb68-3"><a href="#cb68-3"></a><span class="fu">time_diff</span>(today, next_year, <span class="at">time_by =</span> <span class="st">"days"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 366</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># Compared to lubridate</span></span>
<span id="cb70-2"><a href="#cb70-2"></a><span class="fu">mark</span>(<span class="fu">time_diff</span>(flights<span class="sc">$</span>time_hour, <span class="fu">today</span>(), <span class="st">"years"</span>),</span>
<span id="cb70-3"><a href="#cb70-3"></a>     <span class="fu">interval</span>(flights<span class="sc">$</span>time_hour, <span class="fu">today</span>()) <span class="sc">/</span> <span class="fu">years</span>(<span class="dv">1</span>), </span>
<span id="cb70-4"><a href="#cb70-4"></a>     <span class="at">min_iterations =</span> <span class="dv">3</span>)</span>
<span id="cb70-5"><a href="#cb70-5"></a><span class="co">#&gt; Warning: Some expressions had a GC in every iteration; so filtering is</span></span>
<span id="cb70-6"><a href="#cb70-6"></a><span class="co">#&gt; disabled.</span></span>
<span id="cb70-7"><a href="#cb70-7"></a><span class="co">#&gt; # A tibble: 2 × 6</span></span>
<span id="cb70-8"><a href="#cb70-8"></a><span class="co">#&gt;   expression                            min  median `itr/sec` mem_alloc `gc/sec`</span></span>
<span id="cb70-9"><a href="#cb70-9"></a><span class="co">#&gt;   &lt;bch:expr&gt;                        &lt;bch:t&gt; &lt;bch:t&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span></span>
<span id="cb70-10"><a href="#cb70-10"></a><span class="co">#&gt; 1 "time_diff(flights$time_hour, to… 15.43ms 16.16ms    50.7      20.9MB     7.80</span></span>
<span id="cb70-11"><a href="#cb70-11"></a><span class="co">#&gt; 2 "interval(flights$time_hour, tod…   1.32s   1.32s     0.758   654.9MB     6.57</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-3">
<p><code>group_id()</code> assigns each group a unique id and can be useful to use interactively</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb71-2"><a href="#cb71-2"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">group_id</span>(Species)) <span class="sc">|&gt;</span></span>
<span id="cb71-3"><a href="#cb71-3"></a>  <span class="fu">distinct</span>(Species, id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Species id
1     setosa  1
2 versicolor  2
3  virginica  3</code></pre>
</div>
</div>
</div>
<div id="tabset-2-4">
<p>An enhanced <code>diff()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb73-2"><a href="#cb73-2"></a>y <span class="ot">&lt;-</span> <span class="fu">time_seq</span>(today, <span class="at">len =</span> <span class="dv">20</span>, <span class="at">time_by =</span> <span class="st">"weeks"</span>)</span>
<span id="cb73-3"><a href="#cb73-3"></a><span class="fu">diff</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 1 1 1 1 1 1 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="fu">time_elapsed</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] NA  1  1  1  1  1  1  1  1  1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="fu">diff</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time differences in days
 [1] 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="fu">time_elapsed</span>(y, <span class="st">"weeks"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] NA  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a><span class="fu">time_elapsed</span>(y, <span class="st">"days"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] NA  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="fu">time_elapsed</span>(y, <span class="st">"weeks"</span>, <span class="at">rolling =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19</code></pre>
</div>
</div>
</div>
<div id="tabset-2-5">
<p>A function that prioritises pretty-looking breaks</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a><span class="fu">time_breaks</span>(flights<span class="sc">$</span>time_hour)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2013-01-01 05:00:00 EST" "2013-04-01 05:00:00 EDT"
[3] "2013-07-01 05:00:00 EDT" "2013-10-01 05:00:00 EDT"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a><span class="fu">time_breaks</span>(flights<span class="sc">$</span>time_hour, <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2013-01-01 05:00:00 EST" "2013-03-01 05:00:00 EST"
[3] "2013-05-01 05:00:00 EDT" "2013-07-01 05:00:00 EDT"
[5] "2013-09-01 05:00:00 EDT" "2013-11-01 05:00:00 EDT"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="fu">time_cut</span>(flights<span class="sc">$</span>date, <span class="at">n =</span> <span class="dv">10</span>, <span class="at">as_interval =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb89-2"><a href="#cb89-2"></a>  <span class="fu">interval_count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
                  interval     n
                 &lt;tm_intv&gt; &lt;int&gt;
1 [2013-01-01, 2013-03-01) 51955
2 [2013-03-01, 2013-05-01) 57164
3 [2013-05-01, 2013-07-01) 57039
4 [2013-07-01, 2013-09-01) 58752
5 [2013-09-01, 2013-11-01) 56463
6 [2013-11-01, 2014-01-01) 55403</code></pre>
</div>
</div>
</div>
<div id="tabset-2-6">
<p>Identify breaks in a sequence using e.g.&nbsp;<code>time_seq_id</code> <code>time_is_regular</code>, <code>time_num_gaps</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a>hours <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(flights<span class="sc">$</span>time_hour))</span>
<span id="cb91-2"><a href="#cb91-2"></a><span class="fu">time_is_regular</span>(hours)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a><span class="fu">time_is_regular</span>(hours, <span class="at">allow_gaps =</span> <span class="cn">FALSE</span>, <span class="at">allow_dups =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a>id <span class="ot">&lt;-</span> <span class="fu">time_seq_id</span>(hours, <span class="at">time_by =</span> <span class="st">"hours"</span>, <span class="at">threshold =</span> <span class="dv">5</span>) <span class="co"># &gt;5 hours</span></span>
<span id="cb95-2"><a href="#cb95-2"></a><span class="fu">head</span>(hours[id <span class="sc">!=</span> <span class="fu">lead</span>(id)], <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "2013-01-01 23:00:00 EST" "2013-01-02 23:00:00 EST"
 [3] "2013-01-03 23:00:00 EST" "2013-01-04 23:00:00 EST"
 [5] "2013-01-05 23:00:00 EST" "2013-01-06 23:00:00 EST"
 [7] "2013-01-07 23:00:00 EST" "2013-01-08 23:00:00 EST"
 [9] "2013-01-09 23:00:00 EST" "2013-01-10 23:00:00 EST"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="fu">time_num_gaps</span>(hours)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1819</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="fast-dplyr-alternatives" class="slide level2 smaller" data-background-color="white" data-background-image="clock2.jpg">
<h2>Fast dplyr alternatives</h2>
<p>timeplyr has a set of fast dplyr alternative functions, which will likely be moved to a package of their own</p>
<div class="panel-tabset smaller">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">fgroup_by</a></li><li><a href="#tabset-3-2">fcount</a></li><li><a href="#tabset-3-3">fslice</a></li><li><a href="#tabset-3-4">fdistinct</a></li><li><a href="#tabset-3-5">duplicate_rows</a></li></ul>
<div class="tab-content smaller">
<div id="tabset-3-1">
<p>This is very similar to <code>dplyr::group_by</code> except for an attribute <code>sorted</code> that specifies whether the groups are sorted normally or sorted in order-of-first appearance. This is analogous to the difference between the <code>by</code> and <code>keyby</code> construct in data.table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb99-2"><a href="#cb99-2"></a>  <span class="fu">fgroup_by</span>(month) <span class="sc">|&gt;</span> </span>
<span id="cb99-3"><a href="#cb99-3"></a>  <span class="fu">summarise</span>(<span class="at">number_of_flights =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
   month number_of_flights
   &lt;int&gt;             &lt;int&gt;
 1     1             27004
 2     2             24951
 3     3             28834
 4     4             28330
 5     5             28796
 6     6             28243
 7     7             29425
 8     8             29327
 9     9             27574
10    10             28889
11    11             27268
12    12             28135</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb101-2"><a href="#cb101-2"></a>  <span class="fu">fgroup_by</span>(month, <span class="at">order =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb101-3"><a href="#cb101-3"></a>  <span class="fu">summarise</span>(<span class="at">number_of_flights =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
   month number_of_flights
   &lt;int&gt;             &lt;int&gt;
 1     1             27004
 2    10             28889
 3    11             27268
 4    12             28135
 5     2             24951
 6     3             28834
 7     4             28330
 8     5             28796
 9     6             28243
10     7             29425
11     8             29327
12     9             27574</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a><span class="co"># Same as..</span></span>
<span id="cb103-2"><a href="#cb103-2"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb103-3"><a href="#cb103-3"></a>  <span class="fu">summarise</span>(<span class="at">number_of_flights =</span> <span class="fu">n</span>(), <span class="at">.by =</span> month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
   month number_of_flights
   &lt;int&gt;             &lt;int&gt;
 1     1             27004
 2    10             28889
 3    11             27268
 4    12             28135
 5     2             24951
 6     3             28834
 7     4             28330
 8     5             28796
 9     6             28243
10     7             29425
11     8             29327
12     9             27574</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb105-2"><a href="#cb105-2"></a>    <span class="fu">fcount</span>(<span class="fu">across</span>(<span class="fu">where</span>(is_time)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,936 × 3
   time_hour           date           n
   &lt;dttm&gt;              &lt;date&gt;     &lt;int&gt;
 1 2013-01-01 05:00:00 2013-01-01     6
 2 2013-01-01 06:00:00 2013-01-01    52
 3 2013-01-01 07:00:00 2013-01-01    49
 4 2013-01-01 08:00:00 2013-01-01    58
 5 2013-01-01 09:00:00 2013-01-01    56
 6 2013-01-01 10:00:00 2013-01-01    39
 7 2013-01-01 11:00:00 2013-01-01    37
 8 2013-01-01 12:00:00 2013-01-01    56
 9 2013-01-01 13:00:00 2013-01-01    54
10 2013-01-01 14:00:00 2013-01-01    48
# ℹ 6,926 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb107-2"><a href="#cb107-2"></a>  <span class="fu">fcount</span>(<span class="at">.cols =</span> <span class="st">"origin"</span>, <span class="at">order =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  origin      n
  &lt;chr&gt;   &lt;int&gt;
1 EWR    120835
2 LGA    104662
3 JFK    111279</code></pre>
</div>
</div>
</div>
<div id="tabset-3-3">
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1"></a><span class="co"># 1st row of each destination</span></span>
<span id="cb109-2"><a href="#cb109-2"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb109-3"><a href="#cb109-3"></a>  <span class="fu">fslice</span>(<span class="dv">1</span>, <span class="at">.by =</span> dest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 105 × 20
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013    10     1     1955           2001        -6     2213           2248
 2  2013    10     1     1149           1159       -10     1245           1259
 3  2013     1     1     1315           1317        -2     1413           1423
 4  2013     7     6     1629           1615        14     1954           1953
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      905            905         0     1309           1229
 7  2013     1     1      946            959       -13     1146           1202
 8  2013     1     1     1318           1322        -4     1358           1416
 9  2013    10     1     1338           1105       153     1446           1245
10  2013     1     2     2044           2005        39     2229           2158
# ℹ 95 more rows
# ℹ 12 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, date &lt;date&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb111-2"><a href="#cb111-2"></a>  <span class="fu">fslice_head</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">.by =</span> dest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 105 × 20
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013    10     1     1955           2001        -6     2213           2248
 2  2013    10     1     1149           1159       -10     1245           1259
 3  2013     1     1     1315           1317        -2     1413           1423
 4  2013     7     6     1629           1615        14     1954           1953
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      905            905         0     1309           1229
 7  2013     1     1      946            959       -13     1146           1202
 8  2013     1     1     1318           1322        -4     1358           1416
 9  2013    10     1     1338           1105       153     1446           1245
10  2013     1     2     2044           2005        39     2229           2158
# ℹ 95 more rows
# ℹ 12 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, date &lt;date&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1"></a><span class="co"># Last row of each destination</span></span>
<span id="cb113-2"><a href="#cb113-2"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb113-3"><a href="#cb113-3"></a>  <span class="fu">fslice_tail</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">.by =</span> dest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 105 × 20
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     9    30     1959           2001        -2     2209           2248
 2  2013     9    30     1156           1159        -3     1253           1259
 3  2013     9    24     2151           2159        -8     2240           2303
 4  2013     8    24     1633           1625         8     1959           2003
 5  2013     9    30     2053           1815       158     2310           2054
 6  2013     9    30     2052           2054        -2     2306           2358
 7  2013     9    30     1641           1638         3     1833           1829
 8  2013     9    28      741            738         3      823            835
 9  2013     9    30     2203           2205        -2     2339           2331
10  2013     9    30     1939           1950       -11     2112           2141
# ℹ 95 more rows
# ℹ 12 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, date &lt;date&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1"></a><span class="co"># Random 10% of flights by origin airport</span></span>
<span id="cb115-2"><a href="#cb115-2"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb115-3"><a href="#cb115-3"></a>  <span class="fu">fgroup_by</span>(origin, <span class="at">order =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb115-4"><a href="#cb115-4"></a>  <span class="fu">fslice_sample</span>(<span class="at">prop =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33,676 × 20
# Groups:   origin [3]
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     8    28     1818           1805        13     2013           2033
 2  2013     2     3     2221           2159        22     2345           2315
 3  2013    10     3     1159           1200        -1     1259           1315
 4  2013     5    15      620            629        -9      812            825
 5  2013     9    19     1942           1945        -3     2128           2156
 6  2013     4    26     2106           2000        66       13           2259
 7  2013     2     9     1856           1859        -3     2034           2104
 8  2013     3    16     2201           2155         6       43             48
 9  2013    11     1     1832           1742        50     2045           1940
10  2013     6     8     1014            959        15     1223           1207
# ℹ 33,666 more rows
# ℹ 12 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, date &lt;date&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-3-4">
<p><code>fdistinct</code> has a native <code>sort</code> option</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb117-2"><a href="#cb117-2"></a>  <span class="fu">distinct</span>(month) <span class="sc">|&gt;</span> </span>
<span id="cb117-3"><a href="#cb117-3"></a>  <span class="fu">arrange</span>(month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 1
   month
   &lt;int&gt;
 1     1
 2     2
 3     3
 4     4
 5     5
 6     6
 7     7
 8     8
 9     9
10    10
11    11
12    12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb119-2"><a href="#cb119-2"></a>  <span class="fu">fdistinct</span>(month, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 1
   month
   &lt;int&gt;
 1     1
 2     2
 3     3
 4     4
 5     5
 6     6
 7     7
 8     8
 9     9
10    10
11    11
12    12</code></pre>
</div>
</div>
</div>
<div id="tabset-3-5">
<p>This is sort of the inverse of <code>fdistinct</code> and allows us to find duplicate rows very quickly</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb121-2"><a href="#cb121-2"></a>  <span class="fu">duplicate_rows</span>() <span class="co"># No duplicate rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 20
# ℹ 20 variables: year &lt;int&gt;, month &lt;int&gt;, day &lt;int&gt;, dep_time &lt;int&gt;,
#   sched_dep_time &lt;int&gt;, dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;,
#   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, date &lt;date&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb123-2"><a href="#cb123-2"></a>  <span class="fu">duplicate_rows</span>(origin, dest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,552 × 2
   origin dest 
   &lt;chr&gt;  &lt;chr&gt;
 1 LGA    ATL  
 2 EWR    MIA  
 3 EWR    ORD  
 4 LGA    IAH  
 5 LGA    MSP  
 6 JFK    SJU  
 7 LGA    ORD  
 8 LGA    DFW  
 9 JFK    BOS  
10 EWR    PBI  
# ℹ 336,542 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb125-2"><a href="#cb125-2"></a>  <span class="fu">duplicate_rows</span>(origin, dest, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,552 × 2
   origin dest 
   &lt;chr&gt;  &lt;chr&gt;
 1 EWR    ALB  
 2 EWR    ALB  
 3 EWR    ALB  
 4 EWR    ALB  
 5 EWR    ALB  
 6 EWR    ALB  
 7 EWR    ALB  
 8 EWR    ALB  
 9 EWR    ALB  
10 EWR    ALB  
# ℹ 336,542 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="final-thoughts" class="slide level2" data-background-color="white" data-background-image="clock2.jpg">
<h2>Final thoughts</h2>
<p>There is still a lot of room to develop tools centred around time analysis with timeplyr offering a fast, clean and user-friendly interface to dealing with large longitudinal data. </p>
<p>timeplyr, which was initially my personal playground to learn more about R and package development, will hopefully continue to develop and become a routine part of other analysts’ toolkits</p>
</section>
<section id="credits" class="slide level2" data-background-color="white" data-background-image="clock2.jpg">
<h2>Credits</h2>
<div class="smaller">
<p>The R core team <a href="https://www.r-project.org/" class="uri">https://www.r-project.org/</a></p>
<p>The tidyverse team <a href="https://www.tidyverse.org/" class="uri">https://www.tidyverse.org/</a></p>
<p>The data.table Devs <a href="https://rdatatable.gitlab.io/data.table/" class="uri">https://rdatatable.gitlab.io/data.table/</a></p>
<p>The collapse Devs <a href="https://sebkrantz.github.io/collapse/" class="uri">https://sebkrantz.github.io/collapse/</a></p>
</div>

<div class="footer footer-default">

</div>
<aside><div>
<p>Time Background Vectors by <a href="www.vecteezy.com/free-vector/time-background">vecteezy.com</a></p>
</div></aside></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="output_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="output_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="output_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="output_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="output_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="output_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="output_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="output_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="output_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="output_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>